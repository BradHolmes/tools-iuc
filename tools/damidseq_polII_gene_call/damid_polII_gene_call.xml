<tool id="damidseq_polII_gene_call" name="Calculate polII occupancy" version="1.0.2">
    <description>from DamIDseq data</description>
    <requirements>
        <requirement type="package" version="3.4">R</requirement>
    </requirements>
    <version_command><![CDATA[Rscript '$__tool_directory__/polii.gene.call' | grep -o "v.*"]]></version_command>
    <command detect_errors="aggressive"><![CDATA[
ln -fs '$genes' genes.gff &&
ln -fs '$input_file' input.$input_file.ext &&
Rscript '$__tool_directory__/polii.gene.call' --genes.file=genes.gff input.$input_file.ext --iter=$iter --fdr=$fdr && 
mv *.details.csv details.csv &&
mv *.genes genes.csv
    ]]></command>
    <inputs>
        <param name="input_file" type="data" format="gff,bed,bedgraph" label="Select dam-fusion/dam ratio files" help="You can use damidseq_core to produce this file."/>
        <param name="genes" type="data" format="gff" label="Select a GFF file containing genes for which to calculate occupancy"/>
        <param name="iter" type="integer" min="1" value="50000" label="Number of iterations for calculation of FDR"/>
        <param name="fdr" type="float" min="0" max="1" value="0.01" label="FDR cutoff for gene list"/>
    </inputs>
    <outputs>
        <data name="details" format="csv" from_work_dir="details.csv" label="${tool.name} gene details on ${on_string}"/>
        <data name="sig_genes" format="csv" from_work_dir="genes.csv" label="${tool.name} genes on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="input_file" value="polII.bed" ftype="bedgraph"/>
            <param name="genes" value="genes.gff" ftype="gff"/>
            <param name="fdr" value="1"/>
            <param name="iter" value="500"/>
            <output name="details" value="details.csv" compare="sim_size"/>
            <output name="sig_genes" value="genes.csv" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
What it does
------------

Rscript for calculating average PolII occupancy and FDR for RNA Pol II DamID datasets, based on original algorithms developed by Tony Southall.
The script processes datafiles in gatc.bedgraph or gatc.gff format, such as those generated by damidseq_pipeline.

Differences between RNA pol II DamID and RNAseq
-----------------------------------------------
Although both are methods for transcriptional profiling, please be aware that there may be differences between these two methods. In particular, transcript abundancy as assessed through RNAseq will depend on transcript stability, whereas RNA pol II occupancy may provide a better indication of transcription levels.


        ]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btv386</citation>
    </citations>
</tool>
